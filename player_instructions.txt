\033[0;34mAI Player Command Interface\033[0m

\033[1;33mMulti-Client Usage:\033[0m
  ./send_command runner <action> [args...]  - Send command to Runner client (port 7889)
  ./send_command corp <action> [args...]    - Send command to Corp client (port 7890)
  ./send_command <action> [args...]         - Send to default client (backward compatible)

\033[1;33mExamples:\033[0m
  ./send_command runner status              - Check Runner's game status
  ./send_command corp create-game "Test"    - Corp creates a game
  ./send_command runner keep-hand           - Runner keeps mulligan
  ./send_command corp start-game            - Corp starts the game

\033[0;32mStatus Commands:\033[0m
  status          - Show game state (turn, credits, clicks, hand size)
  board           - Show full game board (servers, ICE, rigs)
  hand            - Show cards in hand
  prompt          - Show current prompt (if any)
  credits         - Show current credits
  clicks          - Show remaining clicks
  archives        - Show Corp's Archives (faceup/facedown cards)
  log [N]         - Show last N game log entries (default: 20)
  card-text <name>   - Look up card information (type, cost, text)
  abilities <name>   - Show abilities for installed card
  list-playables  - List all currently playable actions (cards, abilities)

\033[0;32mBasic Actions:\033[0m
  start-turn      - Start your turn (gain clicks, Corp draws card)
  indicate-action - Signal you want to use paid ability (pauses game)
  take-credit     - Spend 1 click to gain 1 credit
  draw            - Spend 1 click to draw 1 card
  end-turn [--force] - End your turn (requires --force if clicks remain)
  smart-end-turn  - Auto-end turn if safe (checks prompts, clicks, EOT triggers)

\033[0;32mMulligan & Hand Management:\033[0m
  keep-hand       - Keep starting hand
  mulligan        - Mulligan (redraw) starting hand
  discard         - Auto-discard down to maximum hand size
  discard <name>... - Discard specific cards by name (e.g., discard "Sure Gamble" "Diesel")
  discard <N>...  - Discard specific cards by index (e.g., discard 0 2 4)

\033[0;32mCard Actions:\033[0m
  play <name>     - Play card by name (e.g., "Sure Gamble")
  play-index <N>  - Play card by index (0-4)
  use-ability <name> <N>  - Use installed card's ability N (e.g., "Smartware Distributor" 0)
  use-runner-ability <name> <N> - Use runner ability on Corp card (e.g., "Brân 1.0" 0 for bioroid)
  trash <name>    - Trash installed card by name (Corp: ICE/asset, Runner: rig)
  rez <name>      - Rez installed Corp card (ICE/asset/upgrade)
  fire-subs <name> - Fire unbroken ICE subroutines (Corp only, during runs)
  auto-pass       - Toggle auto-pass priority during runs (Corp only)
  advance <name>  - Advance installed card (Corp only: agendas, ICE, assets)
  score <name>    - Score agenda with sufficient advancement counters (Corp only)

\033[0;32mRunner Actions:\033[0m
  run <server>    - Run on server (HQ, "R&D", Archives, remote1, etc.)
  let-subs-fire <name> - Signal intent to let ICE subroutines fire (Runner only, during runs)

\033[0;32mPrompts:\033[0m
  choose <N>      - Choose option N from current prompt (0, 1, 2...)
  choose-value <text> - Choose option by matching text (e.g., "keep", "steal")
  choose-card <N> - Choose card N from select prompt (for card-targeting effects)
  continue        - Continue/pass priority (for paid ability windows, run phases)
  continue-run    - Smart run handler (auto-continues both players, stops at decisions)
  jack-out        - Jack out of current run (end run unsuccessfully)
  wait-for-diff [seconds] - Wait for game state change (shows recent log)
  wait-for-log-past <marker> [seconds] - Wait for log entries after marker text

\033[0;32mLobby:\033[0m
  create-game <title> [side] [precon]  - Create new game (default: "Any Side", "worlds-2012-a")
  start-game      - Start game (after creating and opponent joins)
  auto-start      - Auto-start game if lobby is ready (validates 2 players with valid decks)
  leave-game      - Leave current game lobby
  list-lobbies    - List available games to join
  join <game-id> <side>  - Join game as Runner or Corp
  resync <game-id>       - Rejoin already-started game
  chat <message>         - Send chat message to game

\033[0;32mInstallation:\033[0m
  install <name> [server]  - Install card by name (Corp needs server: HQ, "R&D", "New remote")
  install-index <N> [server] - Install card by index (Corp needs server)

\033[0;32mConnection:\033[0m
  connect         - Manually reconnect WebSocket to server

\033[0;32mAdvanced:\033[0m
  eval <expr>     - Execute arbitrary Clojure expression

\033[1;33mTurn Timing Quick Reference:\033[0m
  \033[0;34mCorp Turn:\033[0m gain clicks → draw card → take actions → discard to hand size
    • Use 'continue' to advance through paid ability windows
    • Clicks must be spent before end-turn
    • Discard happens before turn formally ends

  \033[0;34mRunner Turn:\033[0m gain clicks → take actions → discard to hand size
    • No mandatory draw (unlike Corp)
    • Use 'continue' to advance through paid ability windows
    • Clicks must be spent before end-turn

  \033[0;34mRun Sequence:\033[0m initiation → approach ice → encounter ice → movement → access/jack out
    • Initiation: 'run <server>' then 'continue'
    • Approach: Corp may rez ice, then 'continue'
    • Encounter: Break subs with icebreakers, then 'continue'
    • Movement: Can 'jack-out' here, otherwise 'continue' to next ice or server
    • Access: 'choose-value steal/trash/"no action"' for each accessed card
    • Use 'continue-run' for automated run handling (stops at decisions)

  \033[0;34mCommon Stuck States:\033[0m
    • Both at 0 clicks, no prompts → Use 'start-turn' to begin next turn
    • Run stopped → Check 'prompt' to see what decision is needed
    • Turn won't end → Check 'prompt' for blocking discard/ability prompts

\033[1;33mExamples:\033[0m
  ./send_command status
  ./send_command list-lobbies
  ./send_command take-credit
  ./send_command play "Sure Gamble"
  ./send_command install "Daily Casts"
  ./send_command run "R&D"
  ./send_command choose 0
  ./send_command choose-value keep
  ./send_command end-turn

# AI Player Game Reference

## Overview

This document describes the command interface for controlling the AI player in Netrunner via the `send_command` tool. It covers all available commands, game mechanics, and common workflows.

**Usage:**
```bash
./dev/send_command <command> [arguments]
```

## Core Concepts

### Game Structure
- **Sides:** Corp (defending servers) vs Runner (attacking servers)
- **Resources:** Credits (money), Clicks (actions per turn)
- **Servers:** Corp installs cards in servers (HQ, R&D, Archives, Server 1-5)
- **Runs:** Runner attacks servers to access cards

### Turn Flow
1. Start turn (gain clicks, Corp draws mandatory card)
2. Take actions (play cards, install, take credits, make runs)
3. End turn (all clicks must be spent)

### Prompts
Many actions create prompts requiring responses:
- Mulligan (keep or redraw starting hand)
- Run phases (continue, jack out, break ICE)
- Card access (steal, trash, or leave)
- Discard to hand size (select cards to trash)
---

### Basic Click Actions

**Click for credit:**
```bash
./send_command take-credit
```
Spend 1 click, gain 1 credit

**Draw card:**
```bash
./send_command draw
```
Spend 1 click, draw 1 card

---

### Mulligan & Hand Management

**Keep starting hand:**
```bash
./send_command keep-hand
```

**Mulligan (redraw):**
```bash
./send_command mulligan
```

**Discard to hand size:**
```bash
./send_command discard
```
Auto-detects your side, discards from end of hand to reach maximum (usually 5 cards)

---

### Card Actions

**Play card by name:**
```bash
./send_command play "Sure Gamble"
```
Plays events (Runner) or operations (Corp)

**Play card by index:**
```bash
./send_command play-index 0
```
Index: 0-4 for cards in hand

**Install card:**
```bash
# Runner (no server needed):
./send_command install "Daily Casts"
./send_command install-index 0

# Corp (must specify server):
./send_command install "Palisade" "HQ"         # Protect HQ
./send_command install "Palisade" "New remote" # Create new remote server
./send_command install "PAD Campaign" "HQ"     # Install in HQ root
```

Corp server targets:
- `"HQ"`, `"R&D"`, `"Archives"` - Install ICE protecting central servers or assets in server root
- `"New remote"` - Create new remote server
- `"Server 1"`, `"Server 2"`, etc. - Existing remote servers

**Use installed card ability:**
```bash
./send_command use-ability "Smartware Distributor" 0
```
- `<name>` - Installed card name
- `<N>` - Ability index (use `abilities` command to see indices)

**Trash installed card:**
```bash
./send_command trash "Telework Contract"
```

**Rez card (Corp only):**
```bash
./send_command rez "Palisade"
```
Pay rez cost to flip ICE/asset/upgrade faceup

**Advance card (Corp only):**
```bash
./send_command advance "Project Atlas"
```
Spend 1 click and 1 credit to place advancement counter (for scoring agendas)

**Score agenda (Corp only):**
```bash
./send_command score "Project Atlas"
```
Score agenda when it has sufficient advancement counters

**Important Scoring Rules:**
- ⚠️ **Corp turn only** - Cannot score on Runner's turn (prevents "bait and score" strategies)
- ⚠️ **Does NOT cost a click** - Scoring happens at the end of a click action (e.g., after final advance)
- A 2-cost agenda can be fast-advanced in one turn: install-advance-advance-score (3 clicks)
- A 3-cost agenda requires 2 turns minimum (install + 3 advances) or effects (e.g. operations) that cheat advancement
- Some agendas have scoring effects that trigger prompts (e.g., "Send a Message" offers optional ICE rez)

---

#### Run Phase Sequence

A run is NOT a single action - it's a sequence of phases requiring responses:

**1. Initiation Phase**
```bash
./send_command run "R&D"
# Receive prompt: "Continue to Approach Server"
# Phase indicator: "Initiation"
```

**2. Approach ICE (if present)**
```bash
./send_command continue
# Corp gets opportunity to rez ICE
# Runner waits for Corp action
```

**ICE Positions (0-indexed):**
- Position 0 = outermost ICE (encountered first)
- Position 1 = second ICE from outside
- Position N = innermost ICE (encountered last)
- Game log shows: "approaches ice protecting HQ at position 0"

**3. Encounter ICE (if rezzed)**
Runner uses icebreakers to break subroutines:

**Option A: Full Break (auto-break)**
```bash
./send_command use-ability "Unity" 2  # "Fully break Whitespace"
./send_command continue               # Done breaking
```

**Option B: Partial Break (manual subroutine selection)**
```bash
./send_command use-ability "Unity" 0  # "Break 1 Code Gate subroutine"
# Prompt appears: "Break a subroutine"
# Choices:
#   0. [Subroutine 0 text]
#   1. [Subroutine 1 text]
#   2. Done
./send_command choose 0               # Break sub 0
./send_command choose 1               # Done breaking
./send_command continue               # Pass priority
```

**4. Corp fires unbroken subroutines**
```bash
./send_command fire-subs "Whitespace"
```

**5. Approach Server (if run not ended)**
```bash
./send_command continue
# Final continue before accessing cards
```

**6. Access Cards (breach)**
Prompts appear for each accessed card:
```bash
./send_command choose-value steal     # Steal agenda
./send_command choose-value trash     # Trash card (pay trash cost)
./send_command choose-value "no action"  # Leave card
```

**Jacking Out**

⚠️ **CRITICAL: Jack-out timing is restricted!**

You can ONLY jack out **AFTER passing ICE** (between pieces of stacked ICE), OR before final access, NOT during approach or encounter.

Legal jack-out windows:
- ✅ After passing ICE #1, before approaching ICE #2
- ✅ After passing all ICE, before accessing server
- ❌ During approach-ice phase
- ❌ During encounter-ice phase

```bash
# Example: Tactical jack-out after taking damage
./send_command run "R&D"
./send_command continue                    # Approach ICE #1
./send_command continue                    # Encounter ICE #1 (takes 4 net damage)
# ICE fires, you take damage but survive
./send_command continue                    # Pass ICE #1
# Now approaching ICE #2 which might flatline you
./send_command jack-out                    # ✅ Legal - save yourself!
```

**Common mistake:** Trying to jack out when you see dangerous ICE during approach. You MUST encounter it first, let subs fire, THEN jack out if still alive.

**Potential automation:** Jack-out legality could be checked automatically based on run phase:
- `run.phase` = "approach-ice" or "encounter-ice" → jack-out ILLEGAL
- `run.phase` = "movement" (between ICE) → jack-out LEGAL
- Server should enforce this, but worth validating before sending command

#### ICE Breaking Examples

**Full Break (Unity vs Whitespace - Code Gate):**
```bash
./send_command run HQ
./send_command continue                    # Approach
./send_command continue                    # Encounter
./send_command use-ability "Unity" 2       # Fully break Whitespace
./send_command continue                    # Done breaking
./send_command continue                    # Proceed to access
```

**Partial Break (break only dangerous subs):**
```bash
./send_command run HQ
./send_command continue                    # Approach
./send_command continue                    # Encounter
./send_command use-ability "Unity" 0       # Break 1 subroutine
./send_command choose 0                    # Break sub 0
./send_command choose 1                    # Done (let sub 1 fire)
./send_command continue                    # Pass priority
# Corp fires remaining subs (likely ends run)
```

**Type Mismatch (code gate breaker vs barrier ICE):**
```bash
./send_command run "Server 1"
./send_command continue                    # Approach
# Corp rezzes Palisade (Barrier)
./send_command continue                    # Can't break with Unity (Code Gate breaker)
# Corp fires subs, run likely ends
```

**Key Insight:** Always use `card-text` command to check ICE type before running:
```bash
./send_command card-text "Tithe"
# Output: ICE - Sentry - AP
# Conclusion: Need sentry breaker, not barrier/code gate breaker
```

---

### Damage Mechanics

The Runner should consider their current handsize as akin to current health.
The Runner can take three types of damage:

**Net Damage:**
- Common source: Accessing traps and certain agendas
- Effect: Runner discards N cards at random from hand
- If unable to discard enough cards, Runner flatlines (loses game)
- Example: Urtica Cipher deals 2 net damage on access

**Meat Damage:**
- Common source: Corp operations and certain card abilities
- Effect: Identical to net damage (random discard)
- If unable to discard enough cards, Runner flatlines (loses game)

**Brain Damage:**
- Common source: Specific ICE subroutines and Corp cards
- Effect: Random discard PLUS permanent max hand size reduction
- Each point of brain damage permanently reduces max hand size by 1
- If unable to discard enough cards, Runner flatlines (loses game)

**Key Differences from End-of-Turn Discard:**
- Damage = **random discard** (no player choice)
- End-of-turn = **chosen discard** (player selects which cards)
- Damage can cause flatline if hand is empty
- Commands handle damage automatically (cards are randomly trashed)

---

### Prompts & Choices

**Choose by index:**
```bash
./send_command choose 0
./send_command choose 1
```
Use when you know the exact option number

**Choose by value (semantic selection):**
```bash
./send_command choose-value keep
./send_command choose-value steal
./send_command choose-value "jack out"
```
More intuitive, matches text partial and case-insensitive

**Continue/pass priority:**
```bash
./send_command continue
```
Used in:
- Paid ability windows
- Run phases (between approach/encounter/access)
- Passing when no actions to take

---

## Common Workflows

### Game Start Sequence

```bash
# Create game
./send_command create-game "Test Game" "Runner"

# Wait for opponent to join, then start
./send_command start-game

# Handle mulligan
./send_command keep-hand
# or
./send_command mulligan
```

### Basic Runner Turn

```bash
./send_command start-turn

# Play economy card
./send_command play "Sure Gamble"

# Install program/resource
./send_command install "Daily Casts"

# Spend remaining clicks
./send_command take-credit
./send_command take-credit

./send_command end-turn
```

### Basic Corp Turn

```bash
./send_command start-turn
# (Automatically drew mandatory card)

# Install ICE
./send_command install "Palisade" "HQ"

# Install agenda
./send_command install "Project Atlas" "New remote"

# Spend remaining clicks
./send_command take-credit

./send_command end-turn
```

### Making a Run

```bash
# Check board state first
./send_command board
./send_command card-text "Tithe"  # Check ICE type if unknown

# Start run
./send_command run "R&D"

# Respond to prompts
./send_command continue           # Pass initiation
./send_command continue           # Approach ICE
# (Corp rezzes or continues)
./send_command use-ability "Cleaver" 0  # Break if barrier
./send_command choose 0           # Select sub to break
./send_command choose 1           # Done breaking
./send_command continue           # Pass priority

# Access cards
./send_command choose-value steal # Steal agenda if found
```

### Corp Scoring Agenda

```bash
# Advance agenda (repeat 3x for 3/2 agenda)
./send_command advance "Project Atlas"
./send_command advance "Project Atlas"
./send_command advance "Project Atlas"

# Score (if sufficient advancement)
./send_command score "Project Atlas"
```

---

## Technical Notes

### Server Name Format
Always use exact game format:
- **Central servers:** `"HQ"`, `"R&D"`, `"Archives"`
- **Remote servers:** `"Server 1"`, `"Server 2"`, `"Server 3"`, etc.
- **Install targets:** `"New remote"` to create new remote

### Timing
Commands are sent to a persistent REPL maintaining WebSocket connection. Allow 1-2 seconds for server responses between commands in rapid sequences.

### UUID Handling
Game IDs are UUIDs. Copy exact format from `list-lobbies` output:
```
1806d5c9-f540-4158-ab66-8182433dcf10
```

### Error Recovery
If connection drops:
```bash
./send_command connect
./send_command resync <game-id>
```

### Advanced Usage
Execute arbitrary Clojure in the AI client REPL:
```bash
./send_command eval '(println "Debug:" @ws/client-state)'
```

---

## Appendix: Official Timing Structures

These timing structures are taken from the official Netrunner rules. Understanding these helps debug stuck states and timing-dependent interactions.

### Corporation Turn (Rule 5.6)

**5.6.1: Draw Phase**
- a) Corporation gains allotted clicks (default: 3)
- b) Paid ability window. Corp may rez non-ice cards or score agendas during this window
- c) Corporation recurring credits refill
- d) The turn formally begins. Turn begins events resolve
- e) The corporation performs their mandatory draw
- f) Proceed to the action phase (5.6.2)

**5.6.2: Action Phase**
- a) Paid ability window. Corp may rez non-ice cards or score agendas during this window
- b) If the corporation has unspent clicks, they take an action
- c) If an action occurred, return to (a)
- d) The action phase is complete. Proceed to the discard phase (5.6.3)

**5.6.3: Discard Phase**
- a) The corporation discards to maximum hand size, if applicable
- b) Paid ability window. Corp may rez non-ice cards during this window
- c) If the corporation has any clicks remaining, they lose those clicks
- d) The Corporation's turn formally ends. Turn end triggers resolve
- e) Proceed to the Runner turn

### Runner Turn (Rule 5.7)

**5.7.1: Action Phase**
- a) Runner gains allotted clicks (default: 4)
- b) Paid ability window. Corp may rez non-ice cards
- c) Runner recurring credits refill
- d) The turn formally begins. Turn begins events resolve
- e) Paid ability window. Corp may rez non-ice cards
- f) If the Runner has unspent clicks, they take an action
- g) If an action occurred, return to (e)
- h) The action phase is complete. Proceed to the discard phase (5.7.2)

**5.7.2: Discard Phase**
- a) The runner discards to maximum hand size, if applicable
- b) Paid ability window. Corp may rez non-ice cards
- c) If the runner has any clicks remaining, they lose those clicks
- d) The Runner's turn formally ends. Turn end triggers resolve
- e) Proceed to the Corporation turn

### Run Timing Structure (Rule 6.9)

**6.9.1: Initiation Phase**
- a) Runner declares a server
- b) Runner gains Bad Publicity credits
- c) Run formally begins - Run events fire
- d) Paid Ability Window. Corp may rez non-ice cards during this window
- e) Proceed to the outermost ice, if applicable, and begin the approach phase (6.9.2)
- f) Otherwise, proceed to the movement phase (6.9.4)

**6.9.2: Approach Ice Phase**
- a) You are now approaching the ice. Approach events resolve
- b) Paid Ability Window. Corp may rez the approached ice, or non-ice cards, during this window
- c) If approached ice is rezzed, continue to encounter phase (6.9.3)
- d) Otherwise, proceed to the movement phase (6.9.4)

**6.9.3: Encounter Ice Phase**
- a) You are now encountering this ice. Encounter events resolve
- b) Paid ability window. Encountered ice may be interfaced during this window
- c) If there are unbroken subroutines to resolve, the corporation resolves the topmost unbroken subroutine. If they do, repeat this step
- d) The encounter is complete. Proceed to the movement phase (6.9.4)

**6.9.4: Movement Phase**
- a) If you were encountering or approaching an ice, you pass it. Pass-Ice events resolve
- b) If there are no more ice inwards from the passed ice, 'when you pass all ice on the server' events resolve
- c) Paid ability window
- d) The runner may jack out. If they do, proceed to the run ends phase (6.9.6)
- e) The runner proceeds to the next position inwards, if applicable
- f) Paid ability window. The corporation may rez non-ice cards
- g) If you are approaching another ice, return to the approach ice phase (6.9.2)
- h) The runner approaches the attacked server. Approach events resolve
- i) Continue to the success phase (6.9.5)

**6.9.5: Success Phase**
- a) The run is declared successful. Successful run events are met
- b) The runner breaches the attacked server
- c) The success phase is complete. Continue to the run ends phase (6.9.6)

**6.9.6: Run Ends Phase**
- a) Any open priority windows complete or are closed
- b) The runner loses any unspent bad publicity credits
- c) If the success phase was not reached and the server still exists, the run becomes unsuccessful
- d) The run ends. Run ends events resolve

**Key Timing Insights:**
- Paid ability windows occur between almost every action
- `continue` command advances through paid ability windows
- Jack out is ONLY legal at 6.9.4.d (movement phase)
- Discard happens BEFORE turn end (5.6.3.a, 5.7.2.a)
- Clicks are lost in discard phase if unspent (5.6.3.c, 5.7.2.c)
This reference reflects the current implementation. For complete game rules, see the Null Signal Games website.
